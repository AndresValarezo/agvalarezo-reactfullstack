<!DOCTYPE html>
<html lang="en" >
   <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Api Rest</title> 
    <style>
        table,th,td{
            border: 1px solid black;
            border-collapse: collapse;
        }
    </style>  
   </head>
   <body>
        <table>
            <thead>
                <tr>
                    <th> Cars</th>
                    <th> </th>
                    <th></th>
                </tr>
            </thead>
            <tbody id = "tableCars">

            </tbody>
        </table>

        <br>
        <button type="button" id="addCarB"> Add Car  </button>
        <script>
            'use strict';

            window.addEventListener('DOMContentLoaded',_=>{
                showCars();
                addCarB.addEventListener('click', _=>window.location= 'addCars.html')
            });

            async function showCars() {
                const uri = "http://localhost:5000/api/cars";
                const result = await fetch (uri);
                const dates = await  result.json();
                const cars = dates.result;

                const tableCars= document.querySelector("#tableCars");

                while (tableCars.hasChildNodes()){
                    tableCars.removeChild(tableCars.lastChild);
                }
                cars.forEach(element => {
                    const tr= document.createElement("tr");
                    tableCars.appendChild(tr);

                    const td = document.createElement("td");
                    tableCars.appendChild(td);

                    td.appendChild(document.createTextNode(`${element.marca}${element.model}`));

                    const tdDelete = document.createElement("td");
                    tableCars.appendChild(tdDelete);

                    const buttonDelete = document.createElement("button");
                    tdDelete.appendChild(buttonDelete);
                    buttonDelete.setAttribute("value", element.id);
                    buttonDelete.appendChild(document.createTextNode("Delete"));
                    buttonDelete.addEventListener("click", deleteCar);

                    const tdUpdate = document.createElement("td");
                    tableCars.appendChild(tdUpdate);
                    const buttonUpdate = document.createElement("button");
                    tdUpdate.appendChild(buttonUpdate);
                    buttonUpdate.setAttribute("value", element.id);
                    buttonUpdate.appendChild(document.createTextNode("Update"));
                    buttonUpdate.addEventListener("click", updateCar);
                    
                });
            }
            async function deleteCar(event) {
                const carId = parseInt(event.target.value);
                const result = await fetch(`http://localhost:5000/api/cars/${carId}`,{
                    method: "DELETE",
                    headers: {
                        'Accept': 'application/json',
                    },
                });

                const dates= await result.json();
                if(dates.ok)
                {
                    showCars();
                }

            }
            function updateCar(event){
                const carId = event.target.value;
                window.location= `./updateCars.html?car=${carId}`;

            }
        </script>
   </body>


</html>